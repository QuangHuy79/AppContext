ğŸ”¹ BÆ¯á»šC 14 â€“ AUTH REFACTOR
ğŸ¯ Má»¥c Ä‘Ã­ch tá»•ng thá»ƒ
Refactor (tÃ¡i cáº¥u trÃºc) AuthContext Ä‘á»ƒ:

TÃ­ch há»£p vá»›i APIContext â€” thay vÃ¬ mock dá»¯ liá»‡u cá»©ng, Auth giá» sáº½ gá»i API tháº­t (hoáº·c mock server) thÃ´ng qua hÃ m api.post("/login"), api.get("/me"), v.v.

Quáº£n lÃ½ token vÃ  tráº¡ng thÃ¡i xÃ¡c thá»±c Ä‘áº§y Ä‘á»§:

LÆ°u accessToken vÃ  refreshToken trong localStorage.

Tá»± Ä‘á»™ng khÃ´i phá»¥c phiÃªn Ä‘Äƒng nháº­p khi reload.

Tá»± Ä‘á»™ng logout khi token háº¿t háº¡n hoáº·c refresh tháº¥t báº¡i.

Cung cáº¥p cÃ¡c hÃ m tiá»‡n Ã­ch:

login(credentials)

logout()

refreshSession()

isAuthenticated

currentUser

Äá»“ng bá»™ hÃ³a vá»›i DataSyncContext / UIContext / ToastService:

Khi login thÃ nh cÃ´ng â†’ hiá»ƒn thá»‹ toast â€œWelcome back, username!â€

Khi logout â†’ xoÃ¡ dá»¯ liá»‡u ngÆ°á»i dÃ¹ng khá»i AppState

Khi token háº¿t háº¡n â†’ UI hiá»ƒn thá»‹ tráº¡ng thÃ¡i â€œSession expiredâ€

âš™ï¸ Cáº¥u trÃºc file (Ä‘á» xuáº¥t)
src/
â”œâ”€ contexts/
â”‚  â”œâ”€ APIContext/
â”‚  â”‚  â””â”€ APIContext.jsx
â”‚  â”œâ”€ AuthContext/
â”‚  â”‚  â”œâ”€ AuthContext.jsx     â† refactor á»Ÿ bÆ°á»›c nÃ y
â”‚  â”‚  â””â”€ useAuth.js          â† custom hook tiá»‡n Ã­ch
â”‚  â””â”€ ...
â”œâ”€ services/
â”‚  â””â”€ tokenService.js        â† quáº£n lÃ½ token (get/set/clear)
â”œâ”€ test/
â”‚  â””â”€ testAuthRefactor.jsx   â† file test cho bÆ°á»›c 14
ğŸ§  Luá»“ng hoáº¡t Ä‘á»™ng chÃ­nh
Khá»Ÿi táº¡o

Khi App load, AuthContext Ä‘á»c token tá»« localStorage.

Náº¿u cÃ³ token â†’ gá»i api.get("/me") Ä‘á»ƒ láº¥y thÃ´ng tin user â†’ set isAuthenticated = true.

ÄÄƒng nháº­p (login)

Gá»­i POST /login qua APIContext.

Nháº­n accessToken, refreshToken, vÃ  user â†’ lÆ°u vÃ o localStorage.

Cáº­p nháº­t context state â†’ emit toast â€œLogin successâ€.

LÃ m má»›i phiÃªn (refreshSession)

Khi API tráº£ lá»—i 401, APIContext cÃ³ thá»ƒ trigger AuthContext.refreshSession().

Náº¿u refresh thÃ nh cÃ´ng â†’ update token â†’ retry request.

Náº¿u fail â†’ logout.

ÄÄƒng xuáº¥t (logout)

XoÃ¡ token trong localStorage.

Reset user vÃ  tráº¡ng thÃ¡i.

Emit toast â€œLogged outâ€.

ğŸ§© Tráº¡ng thÃ¡i lÆ°u trong AuthContext
{
  user: null,             // thÃ´ng tin ngÆ°á»i dÃ¹ng
  isAuthenticated: false, // tráº¡ng thÃ¡i Ä‘Äƒng nháº­p
  loading: false,         // Ä‘ang xá»­ lÃ½ Ä‘Äƒng nháº­p/khÃ´i phá»¥c
  error: null,            // lá»—i Ä‘Äƒng nháº­p
}
ğŸ”‘ CÃ¡c API chÃ­nh cung cáº¥p qua Context
TÃªn	Chá»©c nÄƒng
login(email, password)	Gá»i API â†’ lÆ°u token â†’ cáº­p nháº­t user
logout()	XoÃ¡ token â†’ reset user
refreshSession()	Gá»i refresh token API
isAuthenticated	Boolean tráº¡ng thÃ¡i
user	Dá»¯ liá»‡u ngÆ°á»i dÃ¹ng hiá»‡n táº¡i
ğŸ§° Káº¿t ná»‘i vá»›i cÃ¡c module khÃ¡c
APIContext: DÃ¹ng Ä‘á»ƒ gá»i api.post("/login"), api.post("/refresh"), api.get("/me")

ToastService: Hiá»ƒn thá»‹ thÃ´ng bÃ¡o (thÃ nh cÃ´ng, tháº¥t báº¡i)

SettingsContext / UIContext: CÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ áº©n/hiá»‡n giao diá»‡n dá»±a vÃ o tráº¡ng thÃ¡i Ä‘Äƒng nháº­p

StatePersistence (BÆ°á»›c 16): Sáº½ tá»± Ä‘á»™ng lÆ°u AuthState vÃ o localStorage