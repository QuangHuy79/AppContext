ğŸ§­ Tá»•ng quan luá»“ng cháº¡y (logic flow)
ChÃºng ta chia luá»“ng ra 4 táº§ng:

Component UI â†’ Hook domain â†’ Context â†’ Reducer â†’ Context State â†’ UI update

Hoáº·c minh há»a ngáº¯n gá»n nhÆ° sau:

User click / event
     â†“
Component gá»i hÃ m trong custom hook (VD: useUI)
     â†“
Hook xá»­ lÃ½ logic / side effect nháº¹ / dispatch action
     â†“
AppContext (Provider) nháº­n action qua useReducer
     â†“
appReducer cáº­p nháº­t state (immutable)
     â†“
Provider â†’ Context value thay Ä‘á»•i â†’ Re-render cÃ¡c component dÃ¹ng useApp/useUI
     â†“
UI component Ä‘á»c state má»›i â†’ render láº¡i (vÃ­ dá»¥ toast hiá»ƒn thá»‹)
ğŸ” Má»• chi tiáº¿t tá»«ng táº§ng
1ï¸âƒ£ UI Component (View Layer)
VÃ­ dá»¥: SidebarToggleButton.jsx, ToastContainer.jsx, LoginForm.jsx.

Vai trÃ²: chá»‰ gá»i API public cá»§a hook (useUI, useAuth, â€¦).

KhÃ´ng trá»±c tiáº¿p dispatch, mÃ  giao cho hook domain xá»­ lÃ½.

Má»¥c tiÃªu: UI cÃ ng â€œngÃ¢y thÆ¡â€ cÃ ng tá»‘t, khÃ´ng chá»©a business logic.

// SidebarToggleButton.jsx
import { useUI } from "../hooks/useUI";

export default function SidebarToggleButton() {
  const { toggleSidebar } = useUI();
  return <button onClick={toggleSidebar}>Toggle Sidebar</button>;
}
2ï¸âƒ£ Hook domain (Logic Layer)
VÃ­ dá»¥: useUI, useAuth, useTheme...

LÃ  bá»™ Ä‘iá»u phá»‘i logic nghiá»‡p vá»¥ (business logic orchestrator).

DÃ¹ng useApp() ná»™i bá»™ Ä‘á»ƒ láº¥y state & dispatch.

CÃ³ thá»ƒ chá»©a side effects (localStorage, analytics, delay...).

GiÃºp tÃ¡ch biá»‡t reducer (pure) khá»i effect (impure).

// useUI.js
import { useApp } from "./useApp";

export function useUI() {
  const { state, dispatch } = useApp();

  const toggleSidebar = () => dispatch({ type: "UI/TOGGLE_SIDEBAR" });

  const showToast = (message, type = "info") => {
    dispatch({ type: "UI/SHOW_TOAST", payload: { message, type } });
    setTimeout(() => dispatch({ type: "UI/CLEAR_TOAST" }), 2500);
  };

  return {
    sidebarOpen: state.ui.sidebarOpen,
    toast: state.ui.toast,
    toggleSidebar,
    showToast,
  };
}
ğŸ‘‰ Hook nÃ y giÃºp UI layer khÃ´ng pháº£i biáº¿t reducer action nÃ o Ä‘ang dÃ¹ng, chá»‰ gá»i showToast() lÃ  xong.

3ï¸âƒ£ AppContext (State Container Layer)
File: AppContext.jsx

Cung cáº¥p state vÃ  dispatch cho toÃ n app.

ÄÆ°á»£c táº¡o bá»Ÿi useReducer(appReducer, initialAppState).

KhÃ´ng chá»©a logic domain, chá»‰ quáº£n lÃ½ vÃ²ng Ä‘á»i global.

Khi dispatch(action), nÃ³ chuyá»ƒn action Ä‘Ã³ tá»›i appReducer.

const [state, dispatch] = useReducer(appReducer, initialAppState);
4ï¸âƒ£ Reducer (Pure Update Logic)
File: appReducer.js

LÃ  nÆ¡i duy nháº¥t thay Ä‘á»•i state.

Pure function (khÃ´ng side-effect).

Nháº­n vÃ o state + action, tráº£ ra state má»›i.

case "UI/TOGGLE_SIDEBAR":
  return {
    ...state,
    ui: { ...state.ui, sidebarOpen: !state.ui.sidebarOpen },
  };
5ï¸âƒ£ Context State (Data Source)
Khi reducer return state má»›i, React sáº½:

Ghi nháº­n state thay Ä‘á»•i â†’ Context Provider sinh ra value má»›i { state, dispatch }.

Táº¥t cáº£ component Ä‘ang useApp() hoáº·c useUI() sáº½ re-render.

Má»—i component re-render chá»‰ khi hook nÃ³ dÃ¹ng cÃ³ giÃ¡ trá»‹ thay Ä‘á»•i (nhá» Reactâ€™s dependency rules hoáº·c memoization).

6ï¸âƒ£ UI Update
CÃ¡c component dÃ¹ng state má»›i render láº¡i.

VÃ­ dá»¥: ToastContainer tháº¥y state.ui.toast != null â†’ render toast.

Khi timeout cháº¡y dispatch({ type: "UI/CLEAR_TOAST" }), toast biáº¿n máº¥t.

âš™ï¸ VÃ­ dá»¥ dÃ²ng cháº¡y thá»±c táº¿
Giáº£ sá»­ user click â€œToggle Sidebarâ€:

SidebarButton (UI)
  â†“ calls
useUI.toggleSidebar()
  â†“ calls
dispatch({ type: "UI/TOGGLE_SIDEBAR" })
  â†“ handled by
appReducer â†’ updates state.ui.sidebarOpen
  â†“
React re-renders Provider â†’ re-renders components using useApp/useUI
  â†“
Sidebar component sees sidebarOpen = true â†’ open animation
CÃ²n náº¿u báº¡n báº¥m â€œShow Toastâ€:

Button â†’ useUI.showToast("Saved!")
  â†“
dispatch(UI/SHOW_TOAST)
  â†“
Reducer sets state.ui.toast = { message: "Saved!" }
  â†“
ToastContainer renders toast
  â†“
setTimeout dispatch(UI/CLEAR_TOAST)
  â†“
Reducer sets toast = null â†’ ToastContainer hides
ğŸ¯ Tá»•ng káº¿t vai trÃ²
Táº§ng	Vai trÃ² chÃ­nh	Chá»©a logic
UI Component	View, event trigger	âŒ KhÃ´ng
Custom Hook (useUI, useAuth)	Xá»­ lÃ½ logic nghiá»‡p vá»¥, side effect	âœ… CÃ³
AppContext	Quáº£n lÃ½ vÃ²ng Ä‘á»i global state	âš™ï¸ Káº¿t ná»‘i
Reducer	Xá»­ lÃ½ cáº­p nháº­t state thuáº§n	âœ… Pure
State (Context value)	Dá»¯ liá»‡u cáº­p nháº­t â†’ render láº¡i UI	âœ… Reactive




âœ… Luá»“ng cháº¡y chuáº©n cá»§a toÃ n bá»™ AppContext Modules (Task 10)
Dá»±a trÃªn cáº¥u trÃºc project báº¡n gá»­i, luá»“ng cháº¡y THáº¬T sáº½ nhÆ° sau:

ğŸ”µ 1. App khá»Ÿi Ä‘á»™ng â†’ AppRuntime.jsx
Táº¡o RuntimeBoundary

Load AppContext vÃ  toÃ n bá»™ Providers theo thá»© tá»± báº¡n Ä‘Ã£ cáº¥u hÃ¬nh
â†’ ÄÃ¢y lÃ  entry point tháº­t cá»§a á»©ng dá»¥ng.

Luá»“ng cháº¡y:
AppRuntime.jsx â†’ <AppProvider>

ğŸ”µ 2. AppProvider bÃªn trong AppContext.jsx
AppProvider sáº½ wrap táº¥t cáº£ module theo Ä‘Ãºng thá»© tá»± báº¡n Ä‘Ã£ build.

Luá»“ng cháº¡y:

<AppContextProvider>
   <StatePersistenceProvider>
     <NetworkProvider>
       <DeviceProvider>
         <SettingsProvider>
           <UIProvider>
             <NotificationProvider>
               <StorageProvider>
                 <CacheProvider>
                   <DataProvider>
                     <DataSyncProvider>
                       <APIProvider>
                         <AuthProvider>
                           {children}
â†’ ÄÃ¢y lÃ  â€œÄ‘Æ°á»ng á»‘ngâ€ chÃ­nh cá»§a toÃ n bá»™ 12 context.

ğŸ”µ 3. CÃ¡c module tá»± kÃ­ch hoáº¡t useEffect láº§n Ä‘áº§u
Khi app load:

(1) NetworkContext
Láº¯ng nghe online/offline

dispatch UI/SHOW_TOAST náº¿u máº¥t máº¡ng

(2) DeviceContext
Láº¥y kÃ­ch thÆ°á»›c mÃ n hÃ¬nh

Láº¯ng nghe resize, orientationchange

(3) SettingsContext
Äá»c theme/language tá»« localStorage

(4) UIContext
Chuáº©n bá»‹ toast queue

(5) NotificationContext
Ready API cho notification

(6) StorageContext
Cung cáº¥p storage.get / set / remove / clear

(7) CacheContext
Táº¡o cache object dÃ¹ng chung

(8) DataContext
loadData() láº§n Ä‘áº§u (náº¿u cÃ³ auto load)

fetchAll trong dataService Ä‘Æ°á»£c kÃ­ch hoáº¡t

(9) DataSyncContext
Theo dÃµi network

Trigger sync náº¿u offline â†’ online

(10) APIContext
Chuáº©n bá»‹ fetch wrapper

gáº¯n api.get / api.post vÃ o context

(11) AuthContext
Restore session tá»« tokenService

Náº¿u cÃ³ token â†’ gá»i API fake /me

dispatch UI/SHOW_TOAST "session restored"

ğŸ”µ 4. Hooks cháº¡y tiáº¿p theo
Khi mÃ n hÃ¬nh sá»­ dá»¥ng dá»¯ liá»‡u:

useDevice() Ä‘á»c DeviceContext

useNetwork() Ä‘á»c NetworkContext

useUI() Ä‘á»c UIContext

useAPI() Ä‘á»c APIContext

useAuth() Ä‘á»c AuthContext

useData() Ä‘á»c DataContext

useDataSync() Ä‘á»c DataSyncContext

useStorage() Ä‘á»c StorageContext

â†’ Hooks khÃ´ng tá»± cháº¡y, chá»‰ khá»Ÿi Ä‘á»™ng khi component gá»i chÃºng.

ğŸ”µ 5. Khi user Login
AuthContext login:

gá»i api.get("/posts")

Ä‘á»£i 600ms

tokenService.setTokens

setUser(fakeUser)

dispatch toast â€œÄÄƒng nháº­p thÃ nh cÃ´ngâ€

ğŸ”µ 6. Khi user Logout
xÃ³a token

setUser(null)

dispatch toast â€œÄÄƒng xuáº¥tâ€

ğŸ”µ 7. Khi user reload trang
StatePersistenceContext khÃ´i phá»¥c appState

tokenService Ä‘á»c token

AuthContext restoreSession()

DataContext cÃ³ thá»ƒ reload data náº¿u báº¡n báº­t autoLoad

UIContext reset toast queue