ğŸ” PHASE 4 â€” SECURITY & DATA SAFETY (ROADMAP CHÃNH THá»¨C)
ğŸ¯ Má»¥c tiÃªu tá»•ng
Frontend KHÃ”NG tin:
user
browser
network
state hiá»‡n táº¡i
Sau Phase 4:
Token khÃ´ng rÃ²
State khÃ´ng bá»‹ abuse
Feature má»›i khÃ´ng vÃ´ tÃ¬nh má»Ÿ lá»— há»•ng
Bug security fail-fast, khÃ´ng silent

ğŸ§± 4.1 â€” Token Lifecycle Lock
â€œToken tá»“n táº¡i, sá»‘ng, cháº¿t pháº£i cÃ³ luáº­tâ€
Invariant cáº§n khÃ³a
Token chá»‰ sá»‘ng á»Ÿ 1 nÆ¡i duy nháº¥t
KhÃ´ng component nÃ o tá»± xá»­ lÃ½ token
Refresh logic khÃ´ng nhÃ¢n báº£n
Checklist
tokenService lÃ  single authority
Access token khÃ´ng expose qua context
Refresh token khÃ´ng leak ra UI
Logout = clear toÃ n bá»™ token + sensitive state
KhÃ´ng Ä‘á»c token trá»±c tiáº¿p tá»« component
ğŸ“Œ Test
Manually clear token â†’ app logout sáº¡ch
401 spam â†’ chá»‰ refresh 1 láº§n
Refresh fail â†’ hard logout
â³ Tráº¡ng thÃ¡i: â¬œ

ğŸ§± 4.2 â€” Auth Boundary & Trust Zone
â€œKhÃ´ng pháº£i component nÃ o cÅ©ng Ä‘Æ°á»£c quyá»n biáº¿t userâ€
Invariant
Auth state khÃ´ng lan toÃ n app
Chá»‰ module cáº§n biáº¿t má»›i Ä‘Æ°á»£c subscribe
Checklist
AuthContext khÃ´ng wrap toÃ n app náº¿u khÃ´ng cáº§n
useAuth() chá»‰ dÃ¹ng á»Ÿ:
guard
orchestrator
auth-aware feature
KhÃ´ng render UI theo user.role trá»±c tiáº¿p
ğŸ“Œ Test
Toggle auth â†’ unrelated feature khÃ´ng commit
Remove AuthProvider â†’ app fail-fast
â³ Tráº¡ng thÃ¡i: â¬œ

ğŸ§± 4.3 â€” Sensitive State Isolation
â€œState nháº¡y cáº£m khÃ´ng sá»‘ng chung vá»›i UI stateâ€
Invariant
KhÃ´ng lÆ°u:
token
permission
raw user profile
trong UIContext / local reducer
Checklist
Sensitive data:
chá»‰ náº±m trong Auth / Secure module
UIContext chá»‰ giá»¯:
boolean
display state
KhÃ´ng serialize sensitive state vÃ o persistence
ğŸ“Œ Test
Inspect persisted state â†’ khÃ´ng tháº¥y token / role
Redux / devtools â†’ khÃ´ng tháº¥y secret
â³ Tráº¡ng thÃ¡i: â¬œ

ğŸ§± 4.4 â€” Persistence & Rehydration Safety
â€œState hydrate sai = security bugâ€
Invariant
KhÃ´ng tin persisted state
Hydration luÃ´n validate version + shape
Checklist
Persisted state cÃ³ version
Version mismatch â†’ drop state
Hydration cÃ³ try/catch + fallback
KhÃ´ng hydrate sensitive data
ğŸ“Œ Test
Modify localStorage â†’ app khÃ´ng crash
Downgrade version â†’ state reset sáº¡ch
â³ Tráº¡ng thÃ¡i: â¬œ

ğŸ§± 4.5 â€” Network Trust Hardening
â€œBackend cÃ³ thá»ƒ sai â€“ frontend pháº£i tá»± vá»‡â€
Invariant
KhÃ´ng tin response shape
KhÃ´ng tin status code
Checklist
API response normalize trÆ°á»›c khi dÃ¹ng
Error object luÃ´n chuáº©n hÃ³a
KhÃ´ng render trá»±c tiáº¿p data chÆ°a validate
Timeout / abort Ä‘Æ°á»£c xá»­ lÃ½
ğŸ“Œ Test
API tráº£ thiáº¿u field â†’ app khÃ´ng crash
Network cháº­m â†’ khÃ´ng freeze UI
â³ Tráº¡ng thÃ¡i: â¬œ

ğŸ§± 4.6 â€” XSS & Injection Guard
â€œUser input lÃ  vÅ© khÃ­â€
Invariant
KhÃ´ng render raw HTML tá»« user
KhÃ´ng inject string vÃ o DOM bá»«a bÃ£i
Checklist
KhÃ´ng dÃ¹ng dangerouslySetInnerHTML (trá»« whitelist)
Encode user-generated content
KhÃ´ng build URL tá»« string chÆ°a sanitize
ğŸ“Œ Test
Input <script> â†’ khÃ´ng execute
Copy-paste payload â†’ UI an toÃ n
â³ Tráº¡ng thÃ¡i: â¬œ

ğŸ§± 4.7 â€” Security Regression Lock
â€œDev má»›i vÃ o khÃ´ng Ä‘Æ°á»£c phÃ¡ Phase 4â€
Invariant
Security rule Ä‘Æ°á»£c ghi rÃµ
Vi pháº¡m lÃ  reject PR
Checklist
README:
Token rules
Persistence rules
Network trust rules
PR checklist:
Feature nÃ y cÃ³ lÆ°u data nháº¡y cáº£m khÃ´ng?
CÃ³ bypass tokenService khÃ´ng?
ğŸ“Œ Test
NgÆ°á»i khÃ¡c Ä‘á»c code váº«n hiá»ƒu vÃ¬ sao khÃ³a váº­y
â³ Tráº¡ng thÃ¡i: â¬œ