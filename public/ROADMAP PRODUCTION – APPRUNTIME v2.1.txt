Gồm 4 giai đoạn chính và 16 bước, theo đúng kiến trúc bạn đã xây dựng.

PHASE 1 — “Stabilization & Final Fix” (Chuẩn hoá Production)
Mục tiêu: Không thay đổi kiến trúc, chỉ chuẩn hóa, tối ưu, loại bỏ code thừa từ quá trình test.

1. Clean-up Source Code Tree
Dựa theo Structure đã lưu:

src/
  AppRuntime/
  contexts/
  services/
  reducers/
  hooks/
  test/
Việc cần làm:

Xóa file test tạm

Xóa module bị duplication từ các vòng test

Đảm bảo mỗi context chỉ tồn tại 1 phiên bản

➡ Mình có thể build lại toàn bộ SRC Folder Tree chuẩn.

2. Chuẩn hoá App.jsx & Main.jsx
Đảm bảo Main.jsx dùng đúng AppRuntimeProvider

Xoá debug, log không cần thiết

Giữ lại log quan trọng (HYDRATE, API_ERRORS)

➡ Bạn đã gửi Main.jsx, mình sẽ tối ưu hoá ngay khi bạn sẵn sàng.

3. Chuẩn hóa StatePersistenceContext
→ Bạn đã bảo mình lưu file StatePersistenceContext.jsx (đã lưu).
Việc tiếp theo:

Remove fallback JSX literal bug

Đảm bảo chỉ HYDRATE 1 lần trong Production (disable StrictMode hoặc wrap safe guard)

Set key: "app_v2_state"

4. Kiểm tra 11 Context Modules
Theo thứ tự đã lưu:

NetworkContext

DeviceContext

SettingsContext

UIContext

CacheContext

StorageContext

NotificationContext

DataContext

DataSyncContext

AuthContext

APIContext

→ Kiểm tra final shape + exports + providers order.

➡ Task 10 bạn đang thực hiện — sẽ tiếp tục.

PHASE 2 — “AppRuntime v2 Orchestration”
Giai đoạn này bạn đang làm Step 18 — Task 10 đến Task 14.

Mục tiêu:

Gom toàn bộ providers thành AppRuntimeProvider duy nhất

Điều phối thứ tự context (orchestration)

Tách thành 3 lớp:

5. Runtime Layering
Xây dựng thứ tự providers chuẩn:

<NetworkProvider>
  <DeviceProvider>
    <SettingsProvider>
      <StorageProvider>  
        <CacheProvider>
          <NotificationProvider>
            <DataProvider>
              <DataSyncProvider>
                <APIProvider>
                  <AuthProvider>
                    {children}
                  </AuthProvider>
                </APIProvider>
              </DataSyncProvider>
            </DataProvider>
          </NotificationProvider>
        </CacheProvider>
      </StorageProvider>
    </SettingsProvider>
  </DeviceProvider>
</NetworkProvider>
→ Đây là điểm quan trọng nhất của Production stability.

6. AppRuntimeProvider v2.1
Ghép toàn bộ 11 module

Add ErrorBoundary bên ngoài

Add StatePersistenceContext ở layer cuối để tránh recursion

7. AppRuntimeClient (optional)
Một dạng lightweight gồm:

useApp()

useAPI()

useAuth()

useCache()

→ Là SDK dành cho UI layer.

PHASE 3 — “Performance Optimization”
Mục tiêu: giảm 40–60% re-render.

8. Memo hóa context values
Thêm useMemo vào tất cả providers nơi giá trị thay đổi không liên tục.

9. useCallback và Batched Updates
Cho:

DataService

APIService

Auth actions

Toast actions

10. Optimize Reducers
Loại bỏ object mutation thừa

Freeze dùng JSON.parse(JSON.stringify()) khi cần

11. Split Providers (Lazy Loading)
Tách module nặng:

AuthContext

DataSync

API

Dùng:

const AuthProvider = lazy(() => import(...));
PHASE 4 — “Production Hardening & QA”
Giai đoạn này để AppRuntime v2 trở thành bản PRO hoàn chỉnh.

12. Error Boundaries Production
Add GlobalErrorBoundary

Add APIErrorBoundary

13. Retry & Backoff cho APIContext
Retry + exponential backoff

Circuit breaker (optional)

14. Network + DataSync Integration Tests
Tiếp tục roadmap Step 17–18:

Kiểm tra mất mạng → restore → resync

Kiểm tra queue & flush của DataSyncContext

15. Full Integration Test Runner
Bạn đã có test/IntegrationRunner.jsx → cần:

Test all contexts working together

Test state persistence

Test hydration

16. Production Build & Profile
Cuối cùng:

Build Vite vite build

Profile performance

Kiểm tra re-render từng context bằng React DevTools