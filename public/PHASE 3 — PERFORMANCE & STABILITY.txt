âš™ï¸ PHASE 3 â€” PERFORMANCE & STABILITY
App khÃ´ng chá»‰ â€œcháº¡y Ä‘Æ°á»£câ€, mÃ  pháº£i chá»‹u táº£i, chá»‹u thá»i gian, chá»‹u user ngu.
â± Thá»i lÆ°á»£ng khuyáº¿n nghá»‹: 1â€“2 tuáº§n
ğŸ“Œ NguyÃªn táº¯c:
KhÃ´ng tá»‘i Æ°u trÆ°á»›c khi audit
KhÃ´ng Ä‘oÃ¡n â€“ chá»‰ quyáº¿t Ä‘á»‹nh dá»±a trÃªn snapshot + render trace
ğŸ§­ PHASE 3 â€” HIGH LEVEL FLOW
Audit â†’ Stabilize â†’ Optimize â†’ Lock invariant
âŒ KhÃ´ng Ä‘Æ°á»£c Ä‘áº£o thá»© tá»±
âŒ KhÃ´ng â€œtá»‘i Æ°u tiá»‡n tayâ€


âš™ï¸ PHASE 3 â€” PERFORMANCE & STABILITY (7 Steps)
3.1 â€” Context & Render Audit
3.2 â€” Context Topology Stabilization
3.3 â€” Memoization Discipline
3.4 â€” Network & Cache Policy
3.5 â€” Background Process Safety
3.6 â€” Runtime Stress & Long-Run Test
3.7 â€” Lock Performance Invariants


ğŸ§± STEP 3.1 â€” CONTEXT & RENDER AUDIT (Báº®T BUá»˜C)
ğŸ¯ Má»¥c tiÃªu
Biáº¿t cÃ¡i gÃ¬ re-render
Biáº¿t vÃ¬ sao re-render
Biáº¿t cÃ³ Ä‘Ã¡ng Ä‘á»ƒ tá»‘i Æ°u hay khÃ´ng
âœ… Checklist
A. Context Inventory
Liá»‡t kÃª táº¥t cáº£ Context:
Provider á»Ÿ Ä‘Ã¢u?
Value gá»“m gÃ¬?
Bao nhiÃªu component consume?
B. Render Trigger Trace
Component nÃ o:
re-render thÆ°á»ng xuyÃªn?
re-render dÃ¹ props khÃ´ng Ä‘á»•i?
C. Snapshot gáº¯n render
Khi render spike:
snapshot state lÃºc Ä‘Ã³ lÃ  gÃ¬?
network cÃ³ báº¯n láº¡i khÃ´ng?
ğŸ“Œ Deliverable
Danh sÃ¡ch:
Context nguy hiá»ƒm
Component re-render thá»«a

ğŸ§  STEP 3.2 â€” CONTEXT TOPOLOGY STABILIZATION
ğŸ¯ Má»¥c tiÃªu
KhÃ´ng cÃ³ context nÃ o lÃ m â€œglobal rerender bombâ€
âœ… Checklist
âŒ Context chá»©a:
object táº¡o má»›i má»—i render
function inline
âœ… TÃ¡ch:
Read context
Write context
âœ… Freeze shape:
value reference á»•n Ä‘á»‹nh
ğŸ“Œ Invariant
Thay Ä‘á»•i nhá» â†’ pháº¡m vi re-render nhá»

ğŸ§© STEP 3.3 â€” MEMOIZATION DISCIPLINE
ğŸ¯ Má»¥c tiÃªu
Memo Ä‘Ãºng thá»© cáº§n memo
KhÃ´ng memo bá»«a
âœ… Checklist
useMemo:
CÃ³ thá»±c sá»± cáº§n?
Dependency Ä‘Ãºng chÆ°a?
useCallback:
Äá»ƒ á»•n Ä‘á»‹nh reference hay che bug?
Selector:
CÃ³ thá»ƒ replace memo khÃ´ng?
ğŸ“Œ Anti-goal
âŒ â€œComponent nÃ y cháº­m â†’ bá»c React.memoâ€
ğŸ“Œ Invariant
Memo Ä‘á»ƒ giá»¯ reference, khÃ´ng pháº£i Ä‘á»ƒ â€œlÃ m nhanh giáº£â€
3.3.1 â€” Stable Actions
Táº¥t cáº£ action hooks (setTheme, toggleTheme, showToast, loadData, updateData, â€¦) pháº£i dÃ¹ng useCallback.
KhÃ´ng táº¡o action inline trong JSX.
âœ… Táº¥t cáº£ module hiá»‡n táº¡i Ä‘Ã£ dÃ¹ng useCallback.
3.3.2 â€” Stable Context Value
Context value object pháº£i memoized báº±ng useMemo.
KhÃ´ng include state trá»±c tiáº¿p náº¿u khÃ´ng cáº§n expose.
âœ… Checked:
SettingsContext, UIContext, CacheContext, StorageContext, NotificationContext, DataContext, DataSyncContext, AuthContext, APIContext â†’ táº¥t cáº£ Ä‘á»u dÃ¹ng useMemo cho value.
3.3.3 â€” Selector Hooks
useXXXSelector khÃ´ng phá»¥ thuá»™c trá»±c tiáº¿p vÃ o state ngoÃ i storeRef.
Selector chá»‰ láº¥y snapshot, khÃ´ng bind state reactive.
âœ… Checked:
SettingsContext, UIContext, DataContext Ä‘á»u dÃ¹ng storeRef.current â†’ stable.
3.3.4 â€” Facade / Public Hooks
Facade hook (useSettings, useUI, useData) memoized hoáº·c sá»­ dá»¥ng selector Ä‘á»ƒ trÃ¡nh re-render unnecessary.
âœ… Checked:
useSettings, useUI, useData â†’ chá»‰ return selected state, khÃ´ng bind toÃ n bá»™ context.
3.3.5 â€” Async Hook Memoization
Async hooks dÃ¹ng useCallback + mounted check.
Async hooks khÃ´ng recreate function má»—i render.
âœ… Checked:
DataContext.loadData, DataSyncContext.syncNow, AuthContext.login â†’ stable + mounted check khi cáº§n.
3.3.6 â€” Avoid Inline Object / Function in JSX
JSX khÃ´ng cÃ³ inline object/function gÃ¢y re-render.
Provider value Ä‘Ã£ memoized â†’ âœ… táº¥t cáº£ module ok.
3.3.7 â€” Integration / Cross-module
Memoization khÃ´ng phÃ¡ stability cross-module (toast, dispatch).
âœ… Checked: dispatch luÃ´n stable, khÃ´ng bind state tá»« module khÃ¡c.
3.3.8 â€” Checklist Pass Criteria
useCallback cho má»i action / async function.
useMemo cho má»i context value object.
Selector chá»‰ dÃ¹ng storeRef.current.
Facade hooks khÃ´ng bind toÃ n bá»™ state reactive.
Async hooks cÃ³ mounted check khi setState.
JSX khÃ´ng inline object/function ngoÃ i useMemo / useCallback.
ğŸ¯ Káº¿t luáº­n:
Khi táº¥t cáº£ checklist trÃªn Ä‘Æ°á»£c confirm â†’ Step 3.3 done.

Tiáº¿p theo lÃ  3.4 â€” Network & Cache Policy.
ğŸŒ STEP 3.4 â€” NETWORK & CACHE POLICY
ğŸ¯ Má»¥c tiÃªu
KhÃ´ng spam API
KhÃ´ng retry ngu
KhÃ´ng fetch láº¡i vÃ¬ render
âœ… Checklist
Má»—i request cÃ³:
Cache TTL
Retry limit
Backoff strategy
Request:
Cancel khi unmount
Pause khi tab inactive
Error:
Attach snapshot
KhÃ´ng loop vÃ´ háº¡n
ğŸ“Œ Deliverable
Báº£ng policy cho:
Query
Mutation
Background fetch

ğŸ” STEP 3.5 â€” BACKGROUND PROCESS SAFETY
ğŸ¯ Má»¥c tiÃªu
KhÃ´ng memory leak
KhÃ´ng CPU leak
KhÃ´ng network leak
âœ… Checklist
setInterval / listener:
Cleanup 100%
WebSocket / subscription:
Reconnect cÃ³ kiá»ƒm soÃ¡t
Background task:
Stop khi app hidden
Stop khi offline
ğŸ“Œ Invariant
App idle = khÃ´ng tiÃªu tÃ i nguyÃªn
Phase 3.5 â€” Background Process Safety (Checklist)
1ï¸âƒ£ Async Safety
 Táº¥t cáº£ async hooks / callbacks Ä‘á»u check mounted trÆ°á»›c khi setState

 finally luÃ´n dá»n dáº¹p loading / syncing / timers

 Errors Ä‘Æ°á»£c catch, khÃ´ng leak ra console ngoÃ i má»¥c Ä‘Ã­ch debug

2ï¸âƒ£ Timer / Interval / Timeout Safety
 Toast timers (UIContext / useUI) cancel Ä‘áº§y Ä‘á»§ khi component unmount

 Background polling / sync timers Ä‘Æ°á»£c clear khi unmount hoáº·c stop process

 KhÃ´ng táº¡o multiple timer khi callback gá»i liÃªn tá»¥c

3ï¸âƒ£ Mounted Check
 Async fetch / update trong DataContext, DataSyncContext, AuthContext, APIContext Ä‘á»u dÃ¹ng mounted ref hoáº·c cleanup function

 KhÃ´ng gá»i setState sau khi unmounted

4ï¸âƒ£ Cancellation / Abort
 APIContext requests há»— trá»£ AbortController â†’ cÃ³ thá»ƒ cancel background fetch

 Thá»±c thi requestWithAuth / fetchAll / syncNow cÃ³ thá»ƒ bá»‹ há»§y an toÃ n

5ï¸âƒ£ Ref & Stable Dispatch
 KhÃ´ng bind state trá»±c tiáº¿p vÃ o background process

 StoreRef / useRef Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ Ä‘á»c state hiá»‡n táº¡i mÃ  khÃ´ng gÃ¢y re-render

 Dispatch stable tá»« UIContext / Toast / AppContext â†’ Ä‘áº£m báº£o khÃ´ng táº¡o re-render ngoÃ i Ã½ muá»‘n

6ï¸âƒ£ Error Handling
 Lá»—i background process (fetch, sync, token refresh) khÃ´ng crash app

 CÃ³ toast / log thÃ´ng bÃ¡o há»£p lÃ½, khÃ´ng spam

7ï¸âƒ£ Cleanup / Unmount
 useEffect cleanup Ä‘áº§y Ä‘á»§ cho má»i async / timer / subscription

 Khi unmount, táº¥t cáº£ timer / background task Ä‘Æ°á»£c clear / abort

 Mounted flag Ä‘Æ°á»£c set false â†’ async hooks khÃ´ng set state

ğŸ“Š STEP 3.6 â€” RUNTIME STRESS & LONG-RUN TEST
ğŸ¯ Má»¥c tiÃªu
App cháº¡y 8â€“24h khÃ´ng degrade
âœ… Checklist
Äá»ƒ app má»Ÿ lÃ¢u:
Memory cÃ³ tÄƒng khÃ´ng?
Network cÃ³ Ä‘á»u khÃ´ng?
Simulate:
User spam action
Network cháº­p chá»n
Snapshot:
TrÆ°á»›c & sau stress
ğŸ“Œ Pass condition
KhÃ´ng memory climb
KhÃ´ng render spike vÃ´ cá»›
KhÃ´ng retry loop

ğŸ”’ STEP 3.7 â€” LOCK PERFORMANCE INVARIANTS
ğŸ¯ Má»¥c tiÃªu
KhÃ´ng ai phÃ¡ Phase 3 vá» sau
âœ… Checklist
Document:
Context rules
Memo rules
Network rules
Guard:
DEV warning náº¿u phÃ¡ invariant
Snapshot:
Báº¯t render anomaly
ğŸ“Œ Outcome

Phase 3 trá»Ÿ thÃ nh luáº­t chÆ¡i, khÃ´ng pháº£i ná»— lá»±c cÃ¡ nhÃ¢n

âœ… PHASE 3 DONE = GÃŒ?
âœ” App khÃ´ng lag theo thá»i gian
âœ” KhÃ´ng render ngáº§m
âœ” KhÃ´ng spam network
âœ” KhÃ´ng leak tÃ i nguyÃªn
âœ” Tá»‘i Æ°u cÃ³ sá»‘ liá»‡u, khÃ´ng cáº£m giÃ¡c








ğŸ” STEP 3.1 â€” CONTEXT & RENDER AUDIT
ğŸ“¥ THá»¨ Tá»° FILE Cáº¦N Gá»¬I (THEO ÄÃšNG LUá»’NG)
Báº¡n gá»­i Ä‘Ãºng thá»© tá»±, má»—i láº§n gá»­i 1 file hoáº·c 1 nhÃ³m file nhá», mÃ¬nh check xong má»›i chuyá»ƒn tiáº¿p.

ğŸ¥‡ GROUP 1 â€” ROOT CONTEXT TOPOLOGY (Báº®T BUá»˜C)
ğŸ‘‰ Má»¥c tiÃªu: hiá»ƒu provider tree gá»‘c & scope render

Gá»­i theo thá»© tá»±:

src/context/AppContext.jsx

src/context/initialState.js

src/App.jsx

src/main.jsx

â›” ChÆ°a gá»­i xong GROUP 1 â†’ khÃ´ng nháº­n file khÃ¡c

ğŸ¥ˆ GROUP 2 â€” RUNTIME / GLOBAL PROVIDERS
ğŸ‘‰ Má»¥c tiÃªu: xÃ¡c Ä‘á»‹nh render boundary cáº¥p runtime

src/runtime/AppRuntimeWrapper.jsx

src/runtime/AppRuntime.jsx

src/runtime/RuntimeOrchestrator.jsx

ğŸ¥‰ GROUP 3 â€” MODULE CONTEXTS (CORE)
ğŸ‘‰ Má»¥c tiÃªu: audit context dá»… gÃ¢y global re-render

Gá»­i theo Ä‘Ãºng thá»© tá»± nÃ y:

src/context/modules/UIContext.jsx

src/context/modules/NetworkContext.jsx

src/context/modules/DeviceContext.jsx

src/context/modules/DataContext.jsx

src/context/modules/DataSyncContext.jsx

â›” CÃ¡c context cÃ²n láº¡i chÆ°a tá»›i lÆ°á»£t

ğŸ… GROUP 4 â€” AUTH / API / STATE PERSISTENCE
ğŸ‘‰ Má»¥c tiÃªu: audit context cÃ³ side-effect + async

src/context/AuthContext/AuthContext.jsx

src/context/APIContext/APIContext.jsx

src/context/StatePersistenceContext.jsx

ğŸ§© GROUP 5 â€” HIGH-TRAFFIC CONSUMERS
ğŸ‘‰ Má»¥c tiÃªu: tÃ¬m component re-render thá»«a

src/hooks/useApp.js

src/hooks/useUI.js

src/hooks/useNetwork.js

src/hooks/useData.js

ğŸ§± GROUP 6 â€” RENDER SPIKE EVIDENCE (Náº¾U CÃ“)
(KhÃ´ng báº¯t buá»™c, nhÆ°ng ráº¥t máº¡nh)

src/debug/RuntimeDebugger.jsx

Snapshot / log liÃªn quan render spike

ğŸ“Œ QUY Táº®C TRONG STEP 3.1 (NHáº®C Láº I)
âŒ KhÃ´ng sá»­a code trÆ°á»›c khi gá»­i

âŒ KhÃ´ng gá»­i dÆ° file

âŒ KhÃ´ng giáº£i thÃ­ch báº±ng lá»i

âœ… Chá»‰ gá»­i code gá»‘c






